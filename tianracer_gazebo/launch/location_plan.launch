<?xml version="1.0"?>
<launch> 
    <!-- Config map file -->
    <arg name="world" default="tianracer_racetrack" /><!-- 赛道地图名称-->   
    <arg name="robot_name" default="$(optenv TIANRACER_NAME tianracer)" doc="robot name [tianracer_No1, tianracer_No2, tianracer_No3, ...]"/><!-- 机器人名称 (支持通过环境变量TIANRACER_NAME设置) -->     
    <arg name="namespace" default="tianracer"/><!-- ROS命名空间 (用于话题隔离) -->
    <!-- 固定坐标系 (基于机器人命名空间) -->
    <arg name="fixed_frame" value="$(arg robot_name)/map"/>
    <!-- 加载地图  -->
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find tianracer_gazebo)/rviz/nav.rviz"/>
    <node name="map_server" pkg="map_server" type="map_server" ns="$(arg namespace)" args="$(find tianracer_gazebo)/maps/tianracer_racetrack.yaml" >
        <param name="frame_id" value="map" />
    </node>
    <!-- ################ 仿真环境加载 ################ -->
    <!-- 启动Gazebo赛道环境 + 机器人模型 -->
    <include file="$(find tianracer_gazebo)/launch/tianracer_on_racetrack.launch">
        <arg name="world" value="$(arg world)" />            <!-- 传递地图参数 -->
        <arg name="robot_name" value="$(arg robot_name)" />  <!-- 机器人命名 -->
    </include>

    <!-- ############# 运动控制系统 ############## -->
    <!-- 连接Gazebo仿真与ROS控制指令 -->
    <include file="$(find tianracer_gazebo)/launch/tianracer_control.launch" >
        <arg name="robot_name" value="$(arg robot_name)" /><!-- 保持命名一致 -->
    </include>

    <!-- move base -->
    <include file="$(find tianracer_gazebo)/launch/includes/teb_base.launch.xml" >
        <arg name="robot_name" value="$(arg namespace)" />
    </include>

        <!-- AMCL -->
    <include file="$(find tianracer_gazebo)/launch/includes/amcl.launch.xml" >
        <arg name="robot_name" value="$(arg namespace)" />
    </include>        

    

    <!-- 键盘控制节点 -->
    <!-- <node name="keyboard_ctl" pkg="tianracer_gazebo" type="keyboard_teleop.py" output="screen"> -->
    <!-- 可调参数          最大前进速度 (m/s)           最大转向角 (rad) -->
        <!-- <param name="~speed" value="0.4" />              
        <param name="~max_steering_angle" value="0.3" />  
    </node> -->

    <!-- 在线调参 -->
    <!-- <node name="rqt_reconfigure" pkg="rqt_reconfigure" type="rqt_reconfigure" output="screen"/>   -->   
    <node pkg="tianracer_navigation" type="mycontrol" name="mycontrol" output="screen"/>
    <node pkg="tianracer_gazebo" type="judge_system_node.py" name="judge_system_node" output="screen"/>
</launch>
